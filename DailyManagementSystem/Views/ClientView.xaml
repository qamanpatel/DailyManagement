<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:DailyManagementSystem.ViewModels"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="700"
             x:Class="DailyManagementSystem.Views.ClientView"
             x:DataType="vm:ClientViewModel">

    <Grid RowDefinitions="Auto,*" ColumnDefinitions="*,350">
        
        <!-- Header -->
        <Grid Grid.Row="0" Grid.ColumnSpan="2" ColumnDefinitions="Auto,*,Auto" Margin="20">
            <StackPanel Orientation="Horizontal" Spacing="15">
                <Button Command="{Binding BackCommand}" Content="â† Back" />
                <TextBlock Text="Client Management" FontSize="24" FontWeight="Bold" VerticalAlignment="Center" Foreground="White"/>
                <Border Background="#37474F" Padding="10,5" CornerRadius="5" VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Role:" Foreground="#B0BEC5" FontSize="11" VerticalAlignment="Center"/>
                        <TextBlock Text="Admin" IsVisible="{Binding IsAdmin}" FontWeight="SemiBold" Foreground="#90CAF9" FontSize="11" VerticalAlignment="Center"/>
                        <TextBlock Text="User" IsVisible="{Binding !IsAdmin}" FontWeight="SemiBold" Foreground="#81C784" FontSize="11" VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </Grid>

        <!-- Left: Client List -->
        <Border Grid.Row="1" Grid.Column="0" Margin="20,0,10,20" BorderBrush="#333333" BorderThickness="1" CornerRadius="8" Background="#1E1E1E">
            <DataGrid ItemsSource="{Binding Clients}" 
                      SelectedItem="{Binding SelectedClient}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      CanUserResizeColumns="True"
                      GridLinesVisibility="Horizontal">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Name" Binding="{Binding ClientName}" Width="1.5*"/>
                    <DataGridTextColumn IsVisible="{Binding $parent[UserControl].((vm:ClientViewModel)DataContext).IsAdmin}" Header="Phone" Binding="{Binding Phone}" Width="120"/>
                    <DataGridTextColumn Header="Address" Binding="{Binding Address}" Width="2*"/>
                </DataGrid.Columns>
                <DataGrid.ContextMenu>
                    <ContextMenu IsVisible="{Binding IsAdmin}">
                        <MenuItem Header="Delete Client" Command="{Binding $parent[UserControl].((vm:ClientViewModel)DataContext).DeleteCommand}" Foreground="Red" IsVisible="{Binding $parent[UserControl].((vm:ClientViewModel)DataContext).IsAdmin}"/>
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </Border>

        <!-- Right: Editor Form -->
        <Border Grid.Row="1" Grid.Column="1" Margin="10,0,20,20" Background="#1E1E1E" BorderBrush="#333333" BorderThickness="1" CornerRadius="8" Padding="20">
            <StackPanel Spacing="15" IsEnabled="{Binding IsFormEnabled}">
                <TextBlock IsVisible="{Binding !IsEditing}" 
                           Text="Add New Client" FontWeight="Bold" FontSize="18"/>
                <TextBlock Text="Edit Client" 
                           IsVisible="{Binding IsEditing}" 
                           FontWeight="Bold" FontSize="18"/>

                <!-- Error Message -->
                <TextBlock Text="{Binding ErrorMessage}" Foreground="Red" TextWrapping="Wrap" IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>

                <StackPanel>
                    <TextBlock Text="Client Name *" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding ClientName}" Watermark="Enter Full Name"/>
                </StackPanel>

                <StackPanel IsVisible="{Binding CanViewContact}">
                    <TextBlock Text="Phone" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding Phone}" Watermark="Phone Number"/>
                </StackPanel>

                <StackPanel>
                    <TextBlock Text="Address" FontWeight="SemiBold"/>
                    <TextBox Text="{Binding Address}" Watermark="Address" Height="80" AcceptsReturn="True"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Spacing="10" Margin="0,20,0,0">
                    <Button Command="{Binding SaveCommand}" Content="Save" Classes="accent" Width="100" HorizontalContentAlignment="Center"/>
                    <Button Command="{Binding ClearCommand}" Content="Cancel" IsVisible="{Binding IsEditing}"/>
                    <Button Command="{Binding DeleteCommand}" Content="Delete" Foreground="Red" IsVisible="{Binding IsAdmin}" IsEnabled="{Binding IsEditing}"/>
                </StackPanel>
            </StackPanel>
        </Border>

    </Grid>
</UserControl>
